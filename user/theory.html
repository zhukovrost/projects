<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/format.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <title>24 / Roman</title>
</head>
<body>
    <!-- Main header -->
    <header class="main_header">
        <a class="logo" href="../index.php"><p>24</p><p>Roman</p></a>
        <button><img src="../img/крест.svg" alt=""></button>
        <div>
          <a href="../user/my_tests.php">My tests</a>
          <a href="">Theory</a>
          <a href="../user/my_marks.php?month=0">Marks</a>
          <a href="../reports/reports.php">Reports</a>
          <a href="../other.html">Other</a>
        </div>
      </header>
      
      <header class="burger_header">
        <a class="logo" href="index.html"><p>24</p><p>Roman</p></a>
        <img src="../img/burger_menu.png" alt="">
      </header>

    <!-- Navigation -->
    <nav class="theory_nav">
        <!-- Search by tag -->
        <div class="search">
            <p>Search: </p>
            <input type="text" placeholder="write tag">
        </div>
        <!-- Most popular themes -->
        <div class="themes">
            <div class="popular">
                <h1><button>All</button> - <button></button> - <button></button></h1>
            </div>
            <div class="medium_popular">
                <h1><button>None</button> - <button>None</button> - <button>None</button></h1>
            </div>
            <div class="unpopular">
                <h1><button>None</button> - <button>None</button> - <button>None</button></h1>
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <!-- Block with all theory -->
            <section class="theory_block">
                <!-- Tags of current theory -->
                <div>
                    <button class="close"><img src="img/крест.svg" alt=""></button>
                    <div class="underline_title">
                        <h2><span>Grammar</span> - <span>Grammar</span> - <span>Past Simple</span></h2>
                    </div>
                    <!-- Theory item -->
                    <div class="item">
                        <!-- Content -->
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <!-- Edit button -->
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <!-- User, date, time -->
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                            
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <!-- Edit button -->
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <!-- User, date, time -->
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                    <!-- Edit button -->
                                    <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <!-- User, date, time -->
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <!-- Edit button -->
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <!-- User, date, time -->
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <!-- Edit button -->
                                <button>Edit <img src="img/edit.svg" alt=""></button>
                                <!-- User, date, time -->
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <!-- Edit button -->
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <!-- User, date, time -->
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <!-- Edit button -->
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <!-- User, date, time -->
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <!-- Edit button -->
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <!-- User, date, time -->
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <!-- Add new message of theory -->
                        <section class="new_message">
                            <h1>Add a new theory</h1>
                            <div>
                                <p>Create block, than edit it:</p>
                                <button class="add_post">Add</button>
                            </div>
                        </section>
                        <!-- Button 'View all' to view all theory item -->
                    </div>
                    <button class="view_all">View all</button>
                </div>
                <div>
                    <button class="close"><img src="img/крест.svg" alt=""></button>
                    <div class="underline_title">
                        <h2><span>aaa</span> - <span>aaa</span> - <span>aaa</span></h2>
                    </div>
                    <div class="item">
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                            
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <section class="new_message">
                            <h1>Add a new theory</h1>
                            <div>
                                <p>Create block, than edit it:</p>
                                <button class="add_post">Add</button>
                            </div>
                        </section>
                    </div>
                    <button class="view_all">View all</button>
                </div>
                <div>
                    <button class="close"><img src="img/крест.svg" alt=""></button>
                    <div class="underline_title">
                        <h2><span>aaa</span> - <span>aaa</span> - <span>aaa</span></h2>
                    </div>
                    <div class="item">
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                            
                        </div>
                        <div class="content">
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cumque dolorum qui fugiat expedita enim sit asperiores vitae quas magnam officia, corporis ratione minima. Consequuntur eveniet blanditiis id, tempora placeat eaque?</p>
                            <div>
                                <button>Edit <img src="../img/edit.svg" alt=""></button>
                                <div class="content_caption">
                                    <p class="user">Admin</p>
                                    <p class="time">19:47</p>
                                    <p class="date">12.09.2024</p>
                                </div>
                            </div>
                        </div>
                        <section class="new_message">
                            <h1>Add a new theory</h1>
                            <div>
                                <p>Create block, than edit it:</p>
                                <button class="add_post">Add</button>
                            </div>
                        </section>
                    </div>
                    <button class="view_all">View all</button>
                </div>
            </section>

            <!-- Block to add new post -->
            <section class="new_post">
                <h1>Add a new post</h1>
                <!-- Form to write tags -->
                <form action="">
                    <p>Tag:</p>
                    <input type="text" placeholder="write tag">
                    <button class="add_post">Add</button>
                </form>
            </section>
        </div>
    </main>

    <footer class="theory_footer">
        <div class="contacts">
            <p>telephone: +7 999-999-99-99</p>
            <p>email: aaaaaaaa@aaa.aaaaaaaa</p>
        </div>
        <div class="company">
            <p>Created by: El Primo</p>
            <p>All rights are reserved</p>
        </div>
    </footer>

    
    <script src="../templates/format.js"></script>
    <script>
        // ===SEARCH===
        // Tag search
        const search_input = document.querySelector('.theory_nav .search input');
        search_input.oninput = function(){
        let val = this.value.trim().replaceAll(' ', '').toUpperCase();
        let testThemes = document.querySelectorAll('.theory_block .underline_title h2');
        if(val != ''){
            for(let i = 0; i < testThemes.length; i++){
                let titlesArr = Array.from(testThemes[i].children);
                count = 0;
                titlesArr.forEach(function(elem){
                    if(elem.innerText.trim().replaceAll(' ', '').toUpperCase().search(val) == -1){
                        count += 1;
                    }
                });

                if(count == titlesArr.length){
                    let cur_test = testThemes[i];
                    cur_test = cur_test.parentNode.parentNode;
                    cur_test.classList.add('hide');
                }
                else{
                    let cur_test = testThemes[i];
                    cur_test = cur_test.parentNode.parentNode;
                    cur_test.classList.remove('hide');
                }
            }
        }
        else{
            for(let i = 0; i < testThemes.length; i++){
                let cur_test = testThemes[i].parentNode.parentNode;
                cur_test.classList.remove('hide');
            }
        }
    }

    // View all
    let viewButtons = document.querySelectorAll('.theory_block .view_all');
    let themeTitles = document.querySelectorAll('.theory_block .underline_title');
    let themeItems = document.querySelectorAll('.theory_block .item');
    let closeButtons = document.querySelectorAll('.theory_block .close');
    const theoryFooter = document.querySelector('.theory_footer')

    for(let i = 0; i < viewButtons.length; i++){
        viewButtons[i].addEventListener('click', function(){
            theoryFooter.style.cssText = `display:none`;

            for(let j = 0; j < themeItems.length; j++){
                viewButtons[j].classList.add('hide');
                if(i != j){
                    themeItems[j].style.cssText = `display: none`;
                }
            }

            themeItems[i].style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                padding: 10vh 10vw;
                min-height: 100vh;
                max-height: none;
            `;
            themeTitles[i].style.cssText = `
                position: absolute;
                z-index: 1000;
                top: 0;
                left: 0;
                margin: 10px 20px;
                color: #5a5a5a;
            `;
            closeButtons[i].style.cssText = `display: block`;
        });
    }

    for(let i = 0; i < closeButtons.length; i++){
        closeButtons[i].addEventListener('click', function(){
            theoryFooter.style.cssText = `display: flex`;

            for(let j = 0; j < themeItems.length; j++){
                viewButtons[j].classList.remove('hide');
                themeItems[j].style.cssText = `display: block`;
            }

            themeItems[i].style.cssText = `
                position: relative;
                top: none;
                left: none;
                padding: 20px 30px;
                max-height: 55vh;
            `;
            themeTitles[i].style.cssText = `
                position: static;
                z-index: 1;
                top: none;
                left: none;
                margin: none;
                margin-bottom: 5px;
                color: #000000;
            `;
            closeButtons[i].style.cssText = `display: none`;
        });
    }
    
    // Most popular themes
    function sortByCount(array)
        {
            if( !Array.isArray(array) )
                throw new TypeError('Неправильный тип, ожидался массив, получен ' + typeof array);

            let valuesMap = new Map();

            array.forEach(elem => {

                valuesMap.set(elem, valuesMap.has(elem) ? valuesMap.get(elem) + 1 :  1);
            });

            let arr =  [...valuesMap.entries()].sort((a, b) => b[1] - a[1]);

            return arr.map(value => value[0]);
        }

    let popularThemes = Array.from(document.querySelectorAll('.theory_block .underline_title h2 span'));
    for(let i = 0; i < popularThemes.length; i++){
        popularThemes[i] = popularThemes[i].innerHTML;
    }

    sortedPopularThemes = sortByCount(popularThemes);

    let popular = document.querySelectorAll('.theory_nav .themes .popular h1 button');
    let mediumPopular = document.querySelectorAll('.theory_nav .themes .medium_popular h1 button');
    let unpopular = document.querySelectorAll('.theory_nav .themes .unpopular h1 button');
    
    for(let i = 1; i < 3; i++){
        if(i < sortedPopularThemes.length){
            popular[i].innerHTML = sortedPopularThemes[i - 1];
        }
    }

    for(let i = 0; i < 3; i++){
        if(i + 2 < sortedPopularThemes.length){
            mediumPopular[i].innerHTML = sortedPopularThemes[i + 2];
        }
    }

    for(let i = 0; i < 3; i++){
        if(i + 5 < sortedPopularThemes.length){
            unpopular[i].innerHTML = sortedPopularThemes[i + 5];
        }
    }
    
    let themesNavigation = document.querySelectorAll('.theory_nav .themes button');
    let testThemes = document.querySelectorAll('.theory_block .underline_title h2');
    
    for(let k = 0; k < themesNavigation.length; k++){
        themesNavigation[k].addEventListener('click', function(){
            if(themesNavigation[k].innerHTML == "All"){
                for(let i = 0; i < testThemes.length; i++){
                    let cur_test = testThemes[i].parentNode.parentNode;
                    cur_test.classList.remove('hide');
                }
            }
            else{
                let val = themesNavigation[k].innerHTML.trim().replaceAll(' ', '').toUpperCase();
                for(let i = 0; i < testThemes.length; i++){
                    let titlesArr = Array.from(testThemes[i].children);
                    count = 0;
                    titlesArr.forEach(function(elem){
                        if(elem.innerText.trim().replaceAll(' ', '').toUpperCase().search(val) == -1){
                            count += 1;
                        }
                    });

                    if(count == titlesArr.length){
                        let cur_test = testThemes[i];
                        cur_test = cur_test.parentNode.parentNode;
                        cur_test.classList.add('hide');
                    }
                    else{
                        let cur_test = testThemes[i];
                        cur_test = cur_test.parentNode.parentNode;
                        cur_test.classList.remove('hide');
                    }
                }
            }
        });
    }

    </script>
    <script src="main.js"></script>
</body>
</html>